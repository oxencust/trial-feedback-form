<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ã€é‡è¨“ï¼å™¨æ¢°ã€‘é«”é©—å›å ±è¡¨ | è¡¡é»å¥åº·</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        :root {
            --white: #ffffff;
            --gray: #808080;
            --gray-light: #f5f5f5;
            --green: #7ac19a;
            --green-light: #e2ede6;
            --green-dark: #5f846f;
            --pink: #f2ac98;
            --pink-light: #faece8;
            --pink-dark: #c67566;
            --yellow: #ffe08b;
            --yellow-light: #fcf4e3;
            --yellow-dark: #ba9e60;
            --blue: #9fcccc;
            --blue-light: #daedec;
            --blue-dark: #66888e;
            --bg-main: var(--green-light);
            --bg-card: var(--white);
            --bg-input: var(--white);
            --primary: var(--green);
            --primary-dark: var(--green-dark);
            --primary-light: var(--green-light);
            --accent: var(--pink);
            --accent-dark: var(--pink-dark);
            --text-primary: #2d3a33;
            --text-secondary: var(--gray);
            --text-light: #9ca89f;
            --border: #d8e0db;
            --border-focus: var(--green);
            --success: var(--green);
            --error: var(--pink-dark);
            --radius: 12px;
            --radius-lg: 20px;
            --shadow: 0 4px 20px rgba(95, 132, 111, 0.1);
            --shadow-lg: 0 8px 30px rgba(95, 132, 111, 0.15);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { overflow-x: hidden; width: 100%; max-width: 100vw; }
        body { font-family: 'Noto Sans TC', -apple-system, BlinkMacSystemFont, sans-serif; background: var(--bg-main); color: var(--text-primary); min-height: 100vh; line-height: 1.6; }
        .header { background: var(--white); padding: 16px 24px; text-align: center; box-shadow: 0 2px 10px rgba(95, 132, 111, 0.08); }
        .logo { font-size: 20px; font-weight: 700; color: var(--green-dark); letter-spacing: 2px; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .logo-icon { font-size: 24px; }
        .logo-sub { font-size: 15px; font-weight: 600; color: var(--text-primary); margin-top: 4px; }
        .coach-info-bar { background: var(--blue-light); padding: 12px 20px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid var(--border); }
        .coach-info-bar.loading { justify-content: center; }
        .coach-avatar { width: 36px; height: 36px; background: var(--blue); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 600; color: var(--white); }
        .coach-details { flex: 1; margin-left: 12px; }
        .coach-name { font-size: 15px; font-weight: 600; color: var(--text-primary); }
        .coach-role { font-size: 12px; color: var(--blue-dark); }
        .coach-status { font-size: 12px; color: var(--text-light); }
        .notice-box { background: var(--yellow-light); border-left: 4px solid var(--yellow-dark); border-radius: 0 var(--radius) var(--radius) 0; padding: 16px 18px; margin-bottom: 20px; overflow: hidden; word-wrap: break-word; }
        .notice-title { font-size: 14px; font-weight: 600; color: var(--yellow-dark); margin-bottom: 10px; display: flex; align-items: center; gap: 6px; }
        .notice-list { font-size: 13px; color: var(--text-primary); line-height: 1.8; padding-left: 20px; }
        .notice-list li { margin-bottom: 4px; }
        .notice-highlight { color: var(--pink-dark); font-weight: 500; }
        .main-content { max-width: 680px; margin: 0 auto; padding: 20px 20px 40px; width: 100%; overflow-x: hidden; }
        .card { background: var(--bg-card); border-radius: var(--radius-lg); padding: 28px; margin-bottom: 16px; box-shadow: var(--shadow); overflow: hidden; }
        .card-header { display: flex; align-items: center; gap: 12px; margin-bottom: 8px; }
        .card-icon { width: 44px; height: 44px; border-radius: 12px; background: var(--green-light); display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .card-title { font-size: 20px; font-weight: 700; color: var(--text-primary); }
        .card-desc { font-size: 14px; color: var(--text-light); margin-bottom: 24px; margin-left: 56px; }
        .section-title { font-size: 15px; font-weight: 600; color: var(--green-dark); margin: 28px 0 16px; padding-bottom: 10px; border-bottom: 2px solid var(--green-light); display: flex; align-items: center; gap: 8px; }
        .section-title:first-of-type { margin-top: 0; }
        .section-dot { width: 8px; height: 8px; background: var(--primary); border-radius: 50%; }
        .form-group { margin-bottom: 24px; }
        .form-group:last-child { margin-bottom: 0; }
        .form-label { display: block; font-size: 15px; font-weight: 500; color: var(--text-primary); margin-bottom: 10px; }
        .form-label .required { color: var(--accent-dark); margin-left: 2px; }
        .form-label .hint { font-weight: 400; color: var(--text-light); font-size: 13px; display: block; margin-top: 6px; line-height: 1.6; }
        .form-input, .form-textarea, .form-select { width: 100%; max-width: 100%; padding: 12px 16px; font-size: 15px; font-family: inherit; border: 2px solid var(--border); border-radius: var(--radius); background: var(--bg-input); color: var(--text-primary); transition: all 0.25s ease; box-sizing: border-box; }
        .form-input:focus, .form-textarea:focus, .form-select:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 4px rgba(122, 193, 154, 0.15); }
        .form-input::placeholder, .form-textarea::placeholder { color: var(--text-light); }
        .form-input:disabled { background: var(--gray-light); cursor: not-allowed; }
        .form-textarea { min-height: 100px; resize: vertical; line-height: 1.6; }
        .member-search-section { background: var(--blue-light); border-radius: var(--radius); padding: 20px; margin-bottom: 24px; overflow: hidden; }
        .search-title { font-size: 14px; font-weight: 600; color: var(--blue-dark); margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
        .search-row { display: grid; grid-template-columns: 1fr 1fr auto; gap: 12px; align-items: end; width: 100%; }
        .search-input-group { display: flex; flex-direction: column; gap: 6px; min-width: 0; }
        .search-input-group label { font-size: 13px; color: var(--text-secondary); }
        .search-input-group input { padding: 10px 14px; font-size: 14px; font-family: inherit; border: 2px solid var(--border); border-radius: var(--radius); background: var(--white); width: 100%; box-sizing: border-box; }
        .search-input-group input:focus { outline: none; border-color: var(--blue); }
        .btn-search { padding: 10px 20px; font-size: 14px; font-weight: 600; font-family: inherit; background: var(--blue); color: var(--white); border: none; border-radius: var(--radius); cursor: pointer; white-space: nowrap; transition: all 0.25s ease; }
        .btn-search:hover { background: var(--blue-dark); }
        .btn-search:disabled { opacity: 0.6; cursor: not-allowed; }
        .search-result { margin-top: 16px; padding: 14px; border-radius: var(--radius); font-size: 14px; display: none; }
        .search-result.show { display: block; }
        .search-result.success { background: var(--green-light); border: 1px solid var(--green); color: var(--green-dark); }
        .search-result.error { background: var(--pink-light); border: 1px solid var(--pink); color: var(--pink-dark); }
        .member-info { display: flex; align-items: center; gap: 12px; }
        .member-avatar { width: 40px; height: 40px; background: var(--green); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 16px; font-weight: 600; color: var(--white); }
        .member-details { flex: 1; }
        .member-name-row { display: flex; align-items: center; gap: 8px; }
        .member-name { font-weight: 600; }
        .member-id { font-size: 12px; background: var(--white); padding: 2px 8px; border-radius: 10px; }
        .member-extra { font-size: 12px; color: var(--text-secondary); margin-top: 2px; }
        .form-grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        .form-grid-2 .form-group { margin-bottom: 0; }
        .inline-radio-group { display: flex; flex-wrap: wrap; gap: 20px; }
        .inline-radio-option { display: flex; align-items: center; gap: 8px; cursor: pointer; }
        .inline-radio-option input[type="radio"] { width: 18px; height: 18px; accent-color: var(--primary); cursor: pointer; margin: 0; }
        .inline-radio-text { font-size: 15px; font-weight: 500; color: var(--text-primary); display: flex; align-items: center; gap: 6px; }
        .inline-radio-icon { font-size: 16px; }
        .radio-group, .checkbox-group { display: flex; flex-wrap: wrap; gap: 10px; }
        .radio-option, .checkbox-option { position: relative; }
        .radio-option input, .checkbox-option input { position: absolute; opacity: 0; }
        .radio-label, .checkbox-label { display: inline-flex; align-items: center; padding: 10px 18px; background: var(--gray-light); border: 2px solid var(--border); border-radius: 50px; cursor: pointer; font-size: 14px; font-weight: 500; color: var(--text-primary); transition: all 0.25s ease; }
        .radio-option input:checked + .radio-label, .checkbox-option input:checked + .checkbox-label { background: var(--green-light); border-color: var(--primary); color: var(--green-dark); }
        .scale-group { display: flex; justify-content: space-between; gap: 6px; width: 100%; }
        .scale-option { flex: 1; position: relative; min-width: 0; }
        .scale-option input { position: absolute; opacity: 0; width: 100%; height: 100%; cursor: pointer; z-index: 1; }
        .scale-label { display: flex; align-items: center; justify-content: center; padding: 14px 8px; background: var(--gray-light); border: 2px solid var(--border); border-radius: 10px; cursor: pointer; font-size: 15px; font-weight: 600; color: var(--text-secondary); transition: all 0.25s ease; }
        .scale-option input:checked + .scale-label { background: var(--primary); border-color: var(--primary); color: var(--white); transform: scale(1.05); box-shadow: 0 4px 12px rgba(122, 193, 154, 0.4); }
        .scale-labels { display: flex; justify-content: space-between; margin-top: 8px; font-size: 12px; color: var(--text-light); }
        .other-input-group { display: flex; align-items: center; gap: 10px; margin-top: 10px; }
        .other-input { flex: 1; padding: 10px 14px; font-size: 14px; font-family: inherit; border: 2px solid var(--border); border-radius: var(--radius); background: var(--bg-input); color: var(--text-primary); transition: all 0.25s ease; }
        .other-input:focus { outline: none; border-color: var(--primary); }
        .other-input::placeholder { color: var(--text-light); }
        .form-input.error, .form-textarea.error { border-color: var(--error); }
        .error-message { font-size: 13px; color: var(--error); margin-top: 6px; display: none; }
        .form-group.has-error .error-message { display: block; }
        .submit-section { margin-top: 32px; }
        .btn-submit { width: 100%; padding: 16px 24px; font-size: 16px; font-weight: 600; font-family: inherit; border-radius: var(--radius); cursor: pointer; transition: all 0.25s ease; display: flex; align-items: center; justify-content: center; gap: 8px; background: var(--primary); color: var(--white); border: none; box-shadow: 0 4px 15px rgba(122, 193, 154, 0.4); }
        .btn-submit:hover { background: var(--primary-dark); transform: translateY(-2px); box-shadow: 0 6px 20px rgba(122, 193, 154, 0.5); }
        .btn-submit:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
        .success-page { display: none; text-align: center; padding: 60px 24px; }
        .success-page.active { display: block; animation: fadeSlideIn 0.4s ease; }
        @keyframes fadeSlideIn { from { opacity: 0; transform: translateY(16px); } to { opacity: 1; transform: translateY(0); } }
        .success-icon { width: 80px; height: 80px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 24px; font-size: 40px; color: var(--white); animation: scaleIn 0.5s ease 0.2s both; box-shadow: 0 8px 30px rgba(122, 193, 154, 0.4); }
        @keyframes scaleIn { from { transform: scale(0); } to { transform: scale(1); } }
        .success-title { font-size: 24px; font-weight: 700; color: var(--text-primary); margin-bottom: 12px; }
        .success-message { font-size: 15px; color: var(--text-secondary); margin-bottom: 32px; line-height: 1.8; }
        .btn-reset { display: inline-flex; padding: 14px 40px; font-size: 15px; font-weight: 600; font-family: inherit; border-radius: var(--radius); cursor: pointer; background: var(--primary); color: var(--white); border: none; box-shadow: 0 4px 15px rgba(122, 193, 154, 0.4); transition: all 0.25s ease; }
        .btn-reset:hover { background: var(--primary-dark); transform: translateY(-2px); }
        .loading-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255, 255, 255, 0.95); z-index: 1000; align-items: center; justify-content: center; flex-direction: column; }
        .loading-overlay.active { display: flex; }
        .loading-spinner { width: 48px; height: 48px; border: 4px solid var(--green-light); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 16px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-text { font-size: 15px; color: var(--text-secondary); font-weight: 500; }
        .error-page { display: none; text-align: center; padding: 60px 24px; }
        .error-page.active { display: block; }
        .error-icon { width: 80px; height: 80px; background: var(--pink-light); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 24px; font-size: 40px; }
        .error-title { font-size: 20px; font-weight: 700; color: var(--text-primary); margin-bottom: 12px; }
        .error-desc { font-size: 14px; color: var(--text-secondary); margin-bottom: 24px; white-space: pre-line; }
        @media (max-width: 767px) {
            .header { padding: 14px 16px; } .logo { font-size: 18px; } .logo-sub { font-size: 14px; } .coach-info-bar { padding: 10px 16px; } .main-content { padding: 16px 14px 40px; } .card { padding: 20px; border-radius: 16px; overflow: hidden; } .card-header { gap: 10px; } .card-icon { width: 40px; height: 40px; font-size: 18px; } .card-title { font-size: 18px; } .card-desc { font-size: 13px; margin-left: 50px; } .form-label { font-size: 14px; } .form-input, .form-textarea { padding: 11px 14px; font-size: 16px; } .form-grid-2 { grid-template-columns: 1fr; gap: 16px; } .search-row { grid-template-columns: 1fr; gap: 10px; } .search-row .btn-search { grid-column: auto; width: 100%; } .inline-radio-group { gap: 16px; } .inline-radio-text { font-size: 14px; } .scale-group { gap: 4px; } .scale-label { padding: 12px 4px; font-size: 13px; border-radius: 8px; } .radio-label, .checkbox-label { padding: 8px 14px; font-size: 13px; } .section-title { font-size: 14px; margin: 24px 0 14px; } .notice-box { padding: 14px 16px; } .notice-list { font-size: 12px; } .member-search-section { padding: 16px; }
        }
        /* ===== å¤§è¢å¹•æ¡Œé¢ (> 1200px) ===== */
        @media (min-width: 1201px) {
            .main-content { max-width: 720px; padding: 28px 32px 50px; }
            .card { padding: 36px; }
            .card-title { font-size: 22px; }
            .form-input, .form-textarea, .form-select { padding: 14px 18px; font-size: 16px; }
            .scale-label { padding: 16px 10px; font-size: 16px; }
            .btn-submit { padding: 18px 28px; font-size: 17px; }
        }
        /* ===== å¹³æ¿ç›´å‘ & å¤§æ‰‹æ©Ÿ (576px - 767px) ===== */
        @media (min-width: 576px) and (max-width: 767px) {
            .form-grid-2 { grid-template-columns: 1fr 1fr; gap: 14px; }
            .search-row { grid-template-columns: 1fr 1fr; gap: 10px; }
            .search-row .btn-search { grid-column: span 2; width: 100%; }
        }
        /* ===== å°æ‰‹æ©Ÿ (361px - 480px) ===== */
        @media (max-width: 480px) {
            .header { padding: 12px 14px; }
            .logo { font-size: 16px; gap: 6px; }
            .logo-icon { font-size: 20px; }
            .logo-sub { font-size: 12px; }
            .coach-info-bar { padding: 10px 14px; }
            .coach-avatar { width: 32px; height: 32px; font-size: 13px; }
            .coach-name { font-size: 14px; }
            .coach-role { font-size: 11px; }
            .main-content { padding: 14px 12px 36px; }
            .card { padding: 18px; border-radius: 14px; }
            .card-icon { width: 36px; height: 36px; font-size: 16px; border-radius: 10px; }
            .card-title { font-size: 17px; }
            .card-desc { font-size: 12px; margin-left: 44px; margin-bottom: 20px; }
            .form-group { margin-bottom: 20px; }
            .form-label { font-size: 13px; margin-bottom: 8px; }
            .form-label .hint { font-size: 12px; }
            .form-input, .form-textarea { padding: 10px 12px; font-size: 16px; border-radius: 10px; }
            .form-textarea { min-height: 90px; }
            .search-row { grid-template-columns: 1fr; gap: 10px; }
            .search-input-group input { padding: 10px 12px; font-size: 16px; }
            .btn-search { width: 100%; grid-column: auto; padding: 12px 16px; }
            .inline-radio-group { gap: 14px; }
            .inline-radio-option input[type="radio"] { width: 16px; height: 16px; }
            .inline-radio-text { font-size: 13px; gap: 5px; }
            .scale-group { gap: 3px; }
            .scale-label { padding: 10px 2px; font-size: 12px; border-radius: 6px; }
            .scale-labels { font-size: 11px; margin-top: 6px; }
            .radio-group, .checkbox-group { gap: 6px; }
            .radio-label, .checkbox-label { padding: 8px 12px; font-size: 12px; }
            .section-title { font-size: 13px; margin: 22px 0 12px; padding-bottom: 8px; }
            .section-dot { width: 6px; height: 6px; }
            .notice-box { padding: 12px 14px; }
            .notice-title { font-size: 13px; margin-bottom: 8px; }
            .notice-list { font-size: 11px; line-height: 1.7; padding-left: 16px; }
            .member-search-section { padding: 14px; }
            .search-title { font-size: 13px; }
            .member-avatar { width: 36px; height: 36px; font-size: 14px; }
            .member-name { font-size: 14px; }
            .member-id { font-size: 11px; padding: 2px 6px; }
            .submit-section { margin-top: 28px; }
            .btn-submit { padding: 14px 20px; font-size: 15px; border-radius: 10px; }
            .success-icon { width: 70px; height: 70px; font-size: 36px; }
            .success-title { font-size: 22px; }
            .success-message { font-size: 14px; }
            .btn-reset { padding: 12px 32px; font-size: 14px; }
            .error-icon { width: 70px; height: 70px; font-size: 36px; }
            .error-title { font-size: 18px; }
            .error-desc { font-size: 13px; }
        }
        /* ===== è¶…å°æ‰‹æ©Ÿ (< 360px) ===== */
        @media (max-width: 360px) {
            .header { padding: 10px 12px; }
            .logo { font-size: 14px; gap: 4px; }
            .logo-icon { font-size: 16px; }
            .logo-sub { font-size: 11px; }
            .coach-info-bar { padding: 8px 10px; }
            .coach-avatar { width: 28px; height: 28px; font-size: 11px; }
            .coach-details { margin-left: 8px; }
            .coach-name { font-size: 13px; }
            .coach-role { font-size: 10px; }
            .coach-status { font-size: 10px; }
            .main-content { padding: 10px 8px 30px; }
            .card { padding: 14px; border-radius: 12px; }
            .card-icon { width: 32px; height: 32px; font-size: 14px; }
            .card-title { font-size: 15px; }
            .card-desc { font-size: 11px; margin-left: 38px; }
            .form-group { margin-bottom: 16px; }
            .form-label { font-size: 12px; }
            .form-label .hint { font-size: 11px; }
            .form-input, .form-textarea { padding: 9px 10px; font-size: 16px; }
            .form-textarea { min-height: 80px; }
            .search-input-group label { font-size: 11px; }
            .search-input-group input { padding: 9px 10px; }
            .btn-search { padding: 10px 14px; font-size: 13px; }
            .search-result { padding: 10px; font-size: 12px; }
            .inline-radio-group { gap: 10px; }
            .inline-radio-text { font-size: 12px; }
            .scale-group { gap: 2px; }
            .scale-label { padding: 8px 1px; font-size: 11px; border-radius: 5px; }
            .scale-labels { font-size: 10px; }
            .radio-label, .checkbox-label { padding: 6px 10px; font-size: 11px; }
            .section-title { font-size: 12px; margin: 18px 0 10px; }
            .section-dot { width: 5px; height: 5px; }
            .notice-box { padding: 10px 12px; }
            .notice-title { font-size: 12px; }
            .notice-list { font-size: 10px; padding-left: 14px; }
            .member-search-section { padding: 12px; }
            .search-title { font-size: 12px; }
            .member-avatar { width: 32px; height: 32px; font-size: 12px; }
            .member-name { font-size: 13px; }
            .member-id { font-size: 10px; }
            .btn-submit { padding: 12px 16px; font-size: 14px; }
            .success-icon { width: 60px; height: 60px; font-size: 30px; }
            .success-title { font-size: 20px; }
            .success-message { font-size: 13px; }
            .btn-reset { padding: 10px 28px; font-size: 13px; }
            .error-icon { width: 60px; height: 60px; font-size: 30px; }
            .error-title { font-size: 16px; }
            .error-desc { font-size: 12px; }
            .loading-spinner { width: 40px; height: 40px; }
            .loading-text { font-size: 13px; }
        }
        /* ===== è§¸æ§å„ªåŒ– ===== */
        @media (hover: none) and (pointer: coarse) {
            .form-input, .form-textarea, .form-select, .search-input-group input, .other-input { font-size: 16px; }
            .btn-search, .btn-submit, .btn-reset { min-height: 44px; }
            .radio-label, .checkbox-label { min-height: 40px; display: inline-flex; align-items: center; }
            .scale-label { min-height: 44px; }
        }
        /* ===== æ©«å‘æ¨¡å¼å„ªåŒ– ===== */
        @media (max-height: 500px) and (orientation: landscape) {
            .header { padding: 8px 16px; }
            .logo-sub { display: none; }
            .coach-info-bar { padding: 6px 16px; }
            .main-content { padding: 12px 20px 30px; }
            .card { padding: 16px; }
            .notice-box { margin-bottom: 12px; }
            .form-group { margin-bottom: 16px; }
            .section-title { margin: 16px 0 10px; }
            .success-page { padding: 20px 24px; }
            .success-icon { width: 50px; height: 50px; font-size: 24px; margin-bottom: 12px; }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo"><span class="logo-icon">ğŸŒ¿</span>è¡¡é»å¥åº·</div>
        <div class="logo-sub">ã€é‡è¨“ï¼å™¨æ¢°ã€‘é«”é©—å›å ±è¡¨</div>
    </header>
    <div class="coach-info-bar loading" id="coachInfoBar"><span class="coach-status">æ­£åœ¨è¼‰å…¥æ•™ç·´è³‡è¨Š...</span></div>
    <main class="main-content" id="mainContent">
        <div class="error-page" id="errorPage">
            <div class="error-icon">âš ï¸</div>
            <h2 class="error-title" id="errorTitle">ç„¡æ³•è¼‰å…¥</h2>
            <p class="error-desc" id="errorDesc">è«‹é€é LINE é–‹å•Ÿæ­¤è¡¨å–®</p>
        </div>
        <div class="notice-box" id="noticeBox" style="display: none;">
            <div class="notice-title">ğŸ“‹ å¡«è¡¨é ˆçŸ¥</div>
            <ol class="notice-list">
                <li>æˆèª²å‰ä¸»å‹•èˆ‡è¡Œæ”¿ç¢ºèªå®¢æˆ¶é ç´„æ™‚é–“èˆ‡è³‡è¨Š</li>
                <li>å»ºè­°èª²ç¨‹é–‹å§‹ <strong>10åˆ†é˜å‰</strong> é ˆæŠµé”å ´é¤¨æº–å‚™</li>
                <li>é«”é©—èª²å‰ç¢ºå¯¦é€²è¡Œ Inbody æª¢æ¸¬åŠè«®è©¢è¡¨å¡«å¯«</li>
                <li>é«”é©—å¾Œä¸€å¾‹ç”±å ´é¤¨è¡Œæ”¿è«‡å–®ï¼Œå¦‚é‡ä¼‘å‡å‰‡ç”±æ•™ç·´é€²è¡Œ</li>
                <li>é«”é©—èª²å¾Œè«‹æ–¼ <span class="notice-highlight">8å°æ™‚å…§</span> å›å¡«æ­¤è¡¨</li>
                <li>ä¸€å°ä¸€é«”é©—ï¼šç¸½é•· 45 åˆ†é˜ ï½œ ä¸€å°äºŒé«”é©—ï¼šç¸½é•· 60 åˆ†é˜</li>
            </ol>
        </div>
        <form id="feedbackForm" style="display: none;">
            <div class="card">
                <div class="card-header"><div class="card-icon">ğŸ“</div><div class="card-title">é«”é©—å›å ±è¡¨</div></div>
                <div class="card-desc">è«‹æ–¼é«”é©—èª²å¾Œå¡«å¯«ä»¥ä¸‹è³‡è¨Š</div>
                <div class="member-search-section">
                    <div class="search-title">ğŸ” æŸ¥è©¢å­¸å“¡ç·¨è™Ÿ</div>
                    <div class="search-row">
                        <div class="search-input-group"><label>å­¸å“¡å§“å</label><input type="text" id="searchName" placeholder="è¼¸å…¥å§“å"></div>
                        <div class="search-input-group"><label>æ‰‹æ©Ÿè™Ÿç¢¼</label><input type="tel" id="searchPhone" placeholder="è¼¸å…¥æ‰‹æ©Ÿè™Ÿç¢¼"></div>
                        <button type="button" class="btn-search" id="btnSearch" onclick="searchMember()">æŸ¥è©¢</button>
                    </div>
                    <div class="search-result" id="searchResult"></div>
                </div>
                <div class="section-title"><span class="section-dot"></span>èª²ç¨‹é¡å‹</div>
                <div class="form-group">
                    <label class="form-label">è«‹é¸æ“‡é«”é©—èª²ç¨‹<span class="required">*</span></label>
                    <div class="inline-radio-group">
                        <label class="inline-radio-option"><input type="radio" name="courseType" value="é‡è¨“" required><span class="inline-radio-text"><span class="inline-radio-icon">ğŸ‹ï¸</span>é‡è¨“</span></label>
                        <label class="inline-radio-option"><input type="radio" name="courseType" value="å™¨æ¢°çš®æ‹‰ææ–¯"><span class="inline-radio-text"><span class="inline-radio-icon">ğŸ§˜</span>å™¨æ¢°çš®æ‹‰ææ–¯</span></label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">æ˜¯å¦ç‚º AI æª¢æ¸¬ä¹‹å®¢æˆ¶<span class="required">*</span></label>
                    <div class="inline-radio-group">
                        <label class="inline-radio-option"><input type="radio" name="isAiCustomer" value="æ˜¯" required><span class="inline-radio-text">æ˜¯</span></label>
                        <label class="inline-radio-option"><input type="radio" name="isAiCustomer" value="å¦"><span class="inline-radio-text">å¦</span></label>
                    </div>
                </div>
                <div class="section-title"><span class="section-dot" style="background: var(--blue);"></span>åŸºæœ¬è³‡è¨Š</div>
                <div class="form-grid-2">
                    <div class="form-group"><label class="form-label">å­¸å“¡ç·¨è™Ÿ</label><input type="text" class="form-input" id="memberId" placeholder="é€éä¸Šæ–¹æŸ¥è©¢è‡ªå‹•å¡«å…¥" readonly></div>
                    <div class="form-group"><label class="form-label">å®¢æˆ¶å§“å<span class="required">*</span></label><input type="text" class="form-input" id="clientName" placeholder="è«‹è¼¸å…¥å®¢æˆ¶å§“å" required><div class="error-message">è«‹è¼¸å…¥å®¢æˆ¶å§“å</div></div>
                </div>
                <div class="form-grid-2">
                    <div class="form-group"><label class="form-label">é«”é©—æ•™ç·´<span class="required">*</span></label><input type="text" class="form-input" id="coachName" placeholder="è‡ªå‹•å¸¶å…¥" readonly><div class="error-message">è«‹è¼¸å…¥æ•™ç·´å§“å</div></div>
                    <div class="form-group"><label class="form-label">é«”é©—æ™‚æ®µ<span class="required">*</span></label><input type="datetime-local" class="form-input" id="sessionTime" required><div class="error-message">è«‹é¸æ“‡é«”é©—æ™‚æ®µ</div></div>
                </div>
                <div class="section-title"><span class="section-dot" style="background: var(--pink);"></span>èª²ç¨‹å…§å®¹</div>
                <div class="form-group">
                    <label class="form-label">èª²å‰è©•ä¼°å­¸å“¡çš„å“ªäº›å•é¡Œ<span class="required">*</span><span class="hint">å¦‚ Inbodyã€èª²å‰è«®è©¢å®¢äººéœ€æ±‚ç­‰</span></label>
                    <textarea class="form-textarea" id="preAssessment" placeholder="è«‹æè¿°èª²å‰è©•ä¼°çš„å…§å®¹..." required></textarea>
                    <div class="error-message">è«‹å¡«å¯«èª²å‰è©•ä¼°å…§å®¹</div>
                </div>
                <div class="form-group">
                    <label class="form-label">ä»Šå¤©å¸¶çµ¦å­¸ç”Ÿçš„èª²ç¨‹å®‰æ’å…§å®¹<span class="required">*</span></label>
                    <div class="checkbox-group">
                        <div class="checkbox-option"><input type="checkbox" name="courseContent" id="content1" value="è‚©èƒŒ"><label class="checkbox-label" for="content1">è‚©èƒŒ</label></div>
                        <div class="checkbox-option"><input type="checkbox" name="courseContent" id="content2" value="æ ¸å¿ƒ"><label class="checkbox-label" for="content2">æ ¸å¿ƒ</label></div>
                        <div class="checkbox-option"><input type="checkbox" name="courseContent" id="content3" value="è‡€è…¿"><label class="checkbox-label" for="content3">è‡€è…¿</label></div>
                        <div class="checkbox-option"><input type="checkbox" name="courseContent" id="content4" value="æŸ”è»Ÿåº¦"><label class="checkbox-label" for="content4">æŸ”è»Ÿåº¦</label></div>
                    </div>
                    <div class="other-input-group"><input type="text" class="other-input" id="contentOther" placeholder="å…¶ä»–ï¼ˆè«‹èªªæ˜ï¼‰"></div>
                </div>
                <div class="section-title"><span class="section-dot" style="background: var(--yellow);"></span>è³¼èª²æ„é¡˜è©•ä¼°</div>
                <div class="form-group">
                    <label class="form-label">èª²å¾Œèªç‚ºå­¸å“¡è²·èª²çš„æ„é¡˜<span class="required">*</span><span class="hint">ç•¶ä¸‹å°±æˆäº¤è«‹é¸ 10</span></label>
                    <div class="scale-group">
                        <div class="scale-option"><input type="radio" name="purchaseWillingness" id="scale1" value="1" required><label class="scale-label" for="scale1">1</label></div>
                        <div class="scale-option"><input type="radio" name="purchaseWillingness" id="scale2" value="2"><label class="scale-label" for="scale2">2</label></div>
                        <div class="scale-option"><input type="radio" name="purchaseWillingness" id="scale3" value="3"><label class="scale-label" for="scale3">3</label></div>
                        <div class="scale-option"><input type="radio" name="purchaseWillingness" id="scale4" value="4"><label class="scale-label" for="scale4">4</label></div>
                        <div class="scale-option"><input type="radio" name="purchaseWillingness" id="scale5" value="5"><label class="scale-label" for="scale5">5</label></div>
                        <div class="scale-option"><input type="radio" name="purchaseWillingness" id="scale6" value="6"><label class="scale-label" for="scale6">6</label></div>
                        <div class="scale-option"><input type="radio" name="purchaseWillingness" id="scale7" value="7"><label class="scale-label" for="scale7">7</label></div>
                        <div class="scale-option"><input type="radio" name="purchaseWillingness" id="scale8" value="8"><label class="scale-label" for="scale8">8</label></div>
                        <div class="scale-option"><input type="radio" name="purchaseWillingness" id="scale9" value="9"><label class="scale-label" for="scale9">9</label></div>
                        <div class="scale-option"><input type="radio" name="purchaseWillingness" id="scale10" value="10"><label class="scale-label" for="scale10">10</label></div>
                    </div>
                    <div class="scale-labels"><span>æ„é¡˜ä½</span><span>ç•¶ä¸‹æˆäº¤</span></div>
                </div>
                <div class="section-title"><span class="section-dot" style="background: var(--blue);"></span>å®¢æœå”åŠ©</div>
                <div class="form-group">
                    <label class="form-label">å®¢æœäººå“¡å¯ä»¥å¦‚ä½•é—œå¿ƒ<span class="required">*</span><span class="hint">è«‹æè¿°å­¸å“¡ç¾å ´çš„å¯¦éš›è€ƒé‡ï¼Œå°±ç®—æœ‰å®¢æœäººå“¡æ¥æ‰‹ä¹Ÿè«‹å¡«å¯«èª²é–“ç™¼ç¾çš„ç‹€æ…‹ã€‚<br>ä¾‹å¦‚ï¼šåƒ¹æ ¼ã€èª²ç¨‹æœŸé™å•é¡Œã€æƒ³å˜—è©¦é¤¨å…§å…¶ä»–èª²ç¨®ã€æƒ³å†é«”é©—å…¶ä»–å¥èº«æˆ¿ç­‰ã€‚<br>â€» è«‹å¦‚å¯¦å¡«å¯«è®“å®¢æœäººå“¡å¯ä»¥é‡‹å‡ºå½ˆæ€§ï¼Œé€²è€Œå”åŠ©åˆ°è€å¸«çš„æˆäº¤ç‡</span></label>
                    <textarea class="form-textarea" id="customerCare" placeholder="è«‹è©³ç´°æè¿°å­¸å“¡çš„è€ƒé‡èˆ‡ç‹€æ…‹..." required></textarea>
                    <div class="error-message">è«‹å¡«å¯«å®¢æœé—œå¿ƒå…§å®¹</div>
                </div>
                <div class="section-title"><span class="section-dot" style="background: var(--pink);"></span>å„ªæƒ æ–¹æ¡ˆ</div>
                <div class="form-group">
                    <label class="form-label">é«”é©—å¾Œçœ‹åˆ°å„ªæƒ è¡¨å°æ–¼å“ªä¸€é …å„ªæƒ æ›´æ„Ÿèˆˆè¶£<span class="required">*</span></label>
                    <div class="checkbox-group">
                        <div class="checkbox-option"><input type="checkbox" name="promoInterest" id="promo1" value="è‚Œè‚‰è³¦èƒ½ä¼¸å±•èª²ç¨‹"><label class="checkbox-label" for="promo1">è‚Œè‚‰è³¦èƒ½ä¼¸å±•èª²ç¨‹</label></div>
                        <div class="checkbox-option"><input type="checkbox" name="promoInterest" id="promo2" value="AI 3Dé«”æ…‹æª¢æ¸¬"><label class="checkbox-label" for="promo2">AI 3Dé«”æ…‹æª¢æ¸¬</label></div>
                        <div class="checkbox-option"><input type="checkbox" name="promoInterest" id="promo3" value="èª²å¡å±•å»¶"><label class="checkbox-label" for="promo3">èª²å¡å±•å»¶</label></div>
                        <div class="checkbox-option"><input type="checkbox" name="promoInterest" id="promo4" value="æ²’æœ‰æä¾›å„ªæƒ è¡¨çµ¦å­¸å“¡"><label class="checkbox-label" for="promo4">æ²’æœ‰æä¾›å„ªæƒ è¡¨</label></div>
                        <div class="checkbox-option"><input type="checkbox" name="promoInterest" id="promo5" value="ç•¶ä¸‹è«‡å–®æœ‰è¡Œæ”¿æ¥æ‰‹"><label class="checkbox-label" for="promo5">ç•¶ä¸‹è¡Œæ”¿æ¥æ‰‹</label></div>
                    </div>
                    <div class="other-input-group"><input type="text" class="other-input" id="promoOther" placeholder="å…¶ä»–ï¼ˆè«‹èªªæ˜ï¼‰"></div>
                </div>
                <div class="submit-section"><button type="submit" class="btn-submit" id="submitBtn">æäº¤è¡¨å–® âœ“</button></div>
            </div>
        </form>
        <div class="success-page" id="successPage">
            <div class="success-icon">âœ“</div>
            <h2 class="success-title">æäº¤æˆåŠŸï¼</h2>
            <p class="success-message">é«”é©—å›å ±è¡¨å·²æˆåŠŸé€å‡º<br>æ„Ÿè¬æ‚¨çš„å¡«å¯«</p>
            <button class="btn-reset" onclick="resetForm()">å¡«å¯«æ–°è¡¨å–®</button>
        </div>
    </main>
    <div class="loading-overlay" id="loadingOverlay"><div class="loading-spinner"></div><div class="loading-text" id="loadingText">æ­£åœ¨æäº¤è¡¨å–®...</div></div>

    <script>
        /* â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
           â•‘                                                                              â•‘
           â•‘                     ğŸ”§ éœ€è¦å¡«å…¥çš„è¨­å®šï¼ˆåªæœ‰ 2 é …ï¼‰                             â•‘
           â•‘                                                                              â•‘
           â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        
        const CONFIG = {
            
            /* â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚                                                                          â”‚
               â”‚  ã€å¿…å¡« 1ã€‘LINE LIFF ID                                                   â”‚
               â”‚                                                                          â”‚
               â”‚  ğŸ“ å–å¾—æ–¹å¼ï¼šLINE Developers Console â†’ ä½ çš„ Provider â†’ Channel          â”‚
               â”‚     â†’ LIFF â†’ æ–°å¢æˆ–é¸æ“‡ LIFF App â†’ è¤‡è£½ LIFF ID                          â”‚
               â”‚                                                                          â”‚
               â”‚  ğŸ“ æ ¼å¼ï¼š'2007474198-xxxxxxxx'                                          â”‚
               â”‚                                                                          â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ */
            
            liffId: '2008660081-J3CVqMrj',
            
            
            /* â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚                                                                          â”‚
               â”‚  ã€å¿…å¡« 2ã€‘Make.com Webhook URLï¼ˆå–®ä¸€å…¥å£ï¼Œè™•ç†æ‰€æœ‰åŠŸèƒ½ï¼‰                   â”‚
               â”‚                                                                          â”‚
               â”‚  ğŸ“ å–å¾—æ–¹å¼ï¼šMake.com â†’ å»ºç«‹æ–° Scenario â†’ æ–°å¢ Webhook æ¨¡çµ„              â”‚
               â”‚     â†’ è¤‡è£½ Webhook URL                                                   â”‚
               â”‚                                                                          â”‚
               â”‚  ğŸ“ æ ¼å¼ï¼š'https://hook.us1.make.com/xxxxxxxxxxxxxxxxx'                  â”‚
               â”‚                                                                          â”‚
               â”‚  ğŸ’¡ æ­¤ Webhook æœƒé€é action æ¬„ä½å€åˆ† 3 ç¨®åŠŸèƒ½ï¼š                           â”‚
               â”‚     â€¢ action: 'search_coach'  â†’ ç”¨ LINE ID æŸ¥è©¢æ•™ç·´                      â”‚
               â”‚     â€¢ action: 'search_member' â†’ ç”¨å§“å/é›»è©±æŸ¥è©¢å­¸å“¡                       â”‚
               â”‚     â€¢ action: 'submit'        â†’ æäº¤è¡¨å–®åˆ° Google Sheet + MySQL          â”‚
               â”‚                                                                          â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ */
            
            webhookUrl: 'https://hook.us2.make.com/5fvtrvpkxzfnwgu6six72t3jpu8fmhu3'
            
        };

        /* â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
           â•‘                       â¬‡ï¸ ä»¥ä¸‹ç¨‹å¼ç¢¼ä¸éœ€è¦ä¿®æ”¹ â¬‡ï¸                              â•‘
           â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

        let currentCoach = { lineId: '', name: '', displayName: '', coachId: '' };
        let matchedMember = null;

        // å¸¶è¶…æ™‚çš„ fetch
        async function fetchWithTimeout(url, options, timeout = 10000) {
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), timeout);
            try {
                const response = await fetch(url, { ...options, signal: controller.signal });
                clearTimeout(timeoutId);
                return response;
            } catch (err) {
                clearTimeout(timeoutId);
                throw err;
            }
        }

        document.addEventListener('DOMContentLoaded', async function() {
            showLoading('æ­£åœ¨åˆå§‹åŒ–...');
            console.log('ğŸš€ é–‹å§‹åˆå§‹åŒ–...');
            console.log('ğŸ“‹ CONFIG:', { liffId: CONFIG.liffId, webhookUrl: CONFIG.webhookUrl?.substring(0, 50) + '...' });
            
            if (CONFIG.liffId.includes('____') || CONFIG.webhookUrl.includes('____')) {
                hideLoading();
                showError('è¨­å®šæœªå®Œæˆ', 'è«‹å…ˆåœ¨ç¨‹å¼ç¢¼ä¸­å¡«å…¥ï¼š\n\n1. LIFF ID\n2. Make Webhook URL');
                return;
            }
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const urlLineId = urlParams.get('lineid') || urlParams.get('lineId') || urlParams.get('line_id');
                
                console.log('ğŸ“± åˆå§‹åŒ– LIFF...');
                await liff.init({ liffId: CONFIG.liffId });
                console.log('âœ… LIFF åˆå§‹åŒ–æˆåŠŸ');
                console.log('ğŸ“Š LIFF ç‹€æ…‹:', { isLoggedIn: liff.isLoggedIn(), isInClient: liff.isInClient() });
                
                if (liff.isLoggedIn()) {
                    console.log('ğŸ‘¤ å–å¾— LINE Profile...');
                    const profile = await liff.getProfile();
                    currentCoach.lineId = profile.userId;
                    currentCoach.displayName = profile.displayName;
                    console.log('âœ… LINE Profile:', profile);
                    await fetchCoachInfo(currentCoach.lineId);
                } else if (urlLineId) {
                    console.log('ğŸ”— ä½¿ç”¨ URL åƒæ•¸ lineId:', urlLineId);
                    currentCoach.lineId = urlLineId;
                    await fetchCoachInfo(urlLineId);
                } else {
                    // æœªç™»å…¥ï¼Œä¸ç®¡æ˜¯ LINE å…§é‚„æ˜¯å¤–éƒ¨ç€è¦½å™¨éƒ½è·³è½‰ç™»å…¥
                    console.log('ğŸ” éœ€è¦ç™»å…¥ï¼Œè·³è½‰ä¸­...');
                    liff.login();
                    return;
                }
            } catch (err) {
                console.error('âŒ LIFF Error:', err);
                if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                    console.log('ğŸ§ª æœ¬æ©Ÿæ¸¬è©¦æ¨¡å¼');
                    currentCoach = { lineId: 'TEST_LINE_ID', name: 'æ¸¬è©¦æ•™ç·´', displayName: 'æ¸¬è©¦æ•™ç·´', coachId: 'TEST001' };
                    showCoachInfo(); showForm();
                } else {
                    showError('åˆå§‹åŒ–å¤±æ•—', err.message || 'è«‹é‡æ–°æ•´ç†é é¢æˆ–è¯ç¹«ç®¡ç†å“¡');
                }
            }
            hideLoading();
        });

        async function fetchCoachInfo(lineId) {
            console.log('ğŸ” æŸ¥è©¢æ•™ç·´è³‡æ–™...', { lineId, webhookUrl: CONFIG.webhookUrl?.substring(0, 50) });
            try {
                const response = await fetchWithTimeout(CONFIG.webhookUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'search_coach', lineId: lineId })
                }, 10000); // 10ç§’è¶…æ™‚
                
                console.log('ğŸ“¥ Webhook å›æ‡‰ç‹€æ…‹:', response.status);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('ğŸ“¦ Webhook å›æ‡‰è³‡æ–™:', data);
                    if (data && data.found) {
                        currentCoach.name = data.name;
                        currentCoach.coachId = data.id;
                        showCoachInfo(); showForm(); return;
                    }
                }
                // æ‰¾ä¸åˆ°æ•™ç·´ï¼Œç”¨ LINE é¡¯ç¤ºåç¨±
                if (currentCoach.displayName) {
                    currentCoach.name = currentCoach.displayName;
                    showCoachInfo(); showForm();
                    console.warn('âš ï¸ æ‰¾ä¸åˆ°æ•™ç·´è³‡æ–™ï¼Œä½¿ç”¨ LINE é¡¯ç¤ºåç¨±:', currentCoach.displayName);
                } else {
                    showError('æ‰¾ä¸åˆ°æ•™ç·´è³‡æ–™', `LINE ID: ${lineId}\n\nè«‹è¯ç¹«ç®¡ç†å“¡åœ¨ coaches è¡¨è¨­å®šæ­¤ LINE ID`);
                }
            } catch (err) {
                console.error('âŒ Fetch coach error:', err);
                if (err.name === 'AbortError') {
                    console.error('â° Webhook è«‹æ±‚è¶…æ™‚ï¼ˆ10ç§’ï¼‰');
                }
                // å³ä½¿æŸ¥è©¢å¤±æ•—ï¼Œæœ‰ displayName å°±å…ˆé¡¯ç¤º
                if (currentCoach.displayName) { 
                    currentCoach.name = currentCoach.displayName; 
                    showCoachInfo(); 
                    showForm();
                    console.warn('âš ï¸ ä½¿ç”¨ LINE é¡¯ç¤ºåç¨±ä½œç‚ºå‚™ç”¨');
                } else { 
                    showError('æŸ¥è©¢æ•™ç·´è³‡æ–™å¤±æ•—', `éŒ¯èª¤ï¼š${err.message}\n\nå¯èƒ½åŸå› ï¼š\n1. Make Webhook æœªå•Ÿå‹•\n2. Webhook URL ä¸æ­£ç¢º\n3. ç¶²è·¯é€£ç·šå•é¡Œ`); 
                }
            }
        }

        function showCoachInfo() {
            const coachBar = document.getElementById('coachInfoBar');
            coachBar.classList.remove('loading');
            coachBar.innerHTML = `<div class="coach-avatar">${currentCoach.name?.charAt(0) || '?'}</div><div class="coach-details"><div class="coach-name">${escapeHtml(currentCoach.name || currentCoach.displayName || 'æœªçŸ¥')}</div><div class="coach-role">é«”é©—æ•™ç·´</div></div><span class="coach-status">å·²ç™»å…¥ âœ“</span>`;
            document.getElementById('coachName').value = currentCoach.name || currentCoach.displayName || '';
            const now = new Date(); now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            document.getElementById('sessionTime').value = now.toISOString().slice(0, 16);
        }

        function showForm() {
            document.getElementById('errorPage').style.display = 'none';
            document.getElementById('noticeBox').style.display = 'block';
            document.getElementById('feedbackForm').style.display = 'block';
            document.getElementById('feedbackForm').addEventListener('submit', submitForm);
        }

        function showError(title, desc) {
            hideLoading(); // ç¢ºä¿éš±è— loading
            document.getElementById('errorPage').classList.add('active');
            document.getElementById('errorTitle').textContent = title;
            document.getElementById('errorDesc').textContent = desc;
            document.getElementById('noticeBox').style.display = 'none';
            document.getElementById('feedbackForm').style.display = 'none';
            const coachBar = document.getElementById('coachInfoBar');
            coachBar.classList.remove('loading');
            coachBar.innerHTML = `<span class="coach-status" style="color: var(--pink-dark);">âš ï¸ ${title}</span>`;
            console.log('âŒ é¡¯ç¤ºéŒ¯èª¤:', title, desc);
        }

        async function searchMember() {
            const name = document.getElementById('searchName').value.trim();
            const phone = document.getElementById('searchPhone').value.trim();
            const resultDiv = document.getElementById('searchResult');
            const btn = document.getElementById('btnSearch');
            if (!name && !phone) { resultDiv.className = 'search-result show error'; resultDiv.innerHTML = 'è«‹è¼¸å…¥å§“åæˆ–æ‰‹æ©Ÿè™Ÿç¢¼'; return; }
            btn.disabled = true; btn.textContent = 'æŸ¥è©¢ä¸­...'; resultDiv.className = 'search-result';
            try {
                const response = await fetchWithTimeout(CONFIG.webhookUrl, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'search_member', name: name, phone: phone })
                });
                const data = await response.json();
                if (data && data.found && data.member) {
                    matchedMember = data.member;
                    resultDiv.className = 'search-result show success';
                    resultDiv.innerHTML = `<div class="member-info"><div class="member-avatar">${escapeHtml(data.member.name?.charAt(0) || '?')}</div><div class="member-details"><div class="member-name-row"><span class="member-name">${escapeHtml(data.member.name)}</span><span class="member-id">${escapeHtml(data.member.id)}</span></div>${data.member.status ? `<div class="member-extra">${escapeHtml(data.member.status)}</div>` : ''}</div></div>`;
                    document.getElementById('memberId').value = data.member.id;
                    document.getElementById('clientName').value = data.member.name;
                } else {
                    matchedMember = null;
                    resultDiv.className = 'search-result show error';
                    resultDiv.innerHTML = 'æ‰¾ä¸åˆ°ç¬¦åˆçš„å­¸å“¡ï¼Œè«‹ç¢ºèªå§“åæˆ–æ‰‹æ©Ÿè™Ÿç¢¼';
                }
            } catch (err) { console.error('Search error:', err); resultDiv.className = 'search-result show error'; resultDiv.innerHTML = 'æŸ¥è©¢å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦'; }
            finally { btn.disabled = false; btn.textContent = 'æŸ¥è©¢'; }
        }

        function validateForm() {
            let valid = true;
            ['clientName', 'sessionTime', 'preAssessment', 'customerCare'].forEach(id => {
                const field = document.getElementById(id); const group = field.closest('.form-group');
                if (!field.value.trim()) { group.classList.add('has-error'); field.classList.add('error'); valid = false; }
                else { group.classList.remove('has-error'); field.classList.remove('error'); }
            });
            if (!document.querySelector('input[name="courseType"]:checked')) { valid = false; alert('è«‹é¸æ“‡èª²ç¨‹é¡å‹'); }
            if (!document.querySelector('input[name="isAiCustomer"]:checked')) { valid = false; alert('è«‹é¸æ“‡æ˜¯å¦ç‚º AI æª¢æ¸¬ä¹‹å®¢æˆ¶'); }
            if (!document.querySelector('input[name="purchaseWillingness"]:checked')) { valid = false; alert('è«‹é¸æ“‡å­¸å“¡è²·èª²æ„é¡˜'); }
            const contentChecked = document.querySelectorAll('input[name="courseContent"]:checked').length > 0;
            if (!contentChecked && !document.getElementById('contentOther').value.trim()) { valid = false; alert('è«‹é¸æ“‡æˆ–å¡«å¯«èª²ç¨‹å®‰æ’å…§å®¹'); }
            const promoChecked = document.querySelectorAll('input[name="promoInterest"]:checked').length > 0;
            if (!promoChecked && !document.getElementById('promoOther').value.trim()) { valid = false; alert('è«‹é¸æ“‡æˆ–å¡«å¯«æ„Ÿèˆˆè¶£çš„å„ªæƒ æ–¹æ¡ˆ'); }
            return valid;
        }

        async function submitForm(e) {
            e.preventDefault(); if (!validateForm()) return;
            const btn = document.getElementById('submitBtn'); btn.disabled = true; showLoading('æ­£åœ¨æäº¤è¡¨å–®...');
            try {
                const courseContent = []; document.querySelectorAll('input[name="courseContent"]:checked').forEach(cb => courseContent.push(cb.value));
                const contentOther = document.getElementById('contentOther').value.trim(); if (contentOther) courseContent.push(contentOther);
                const promoInterest = []; document.querySelectorAll('input[name="promoInterest"]:checked').forEach(cb => promoInterest.push(cb.value));
                const promoOther = document.getElementById('promoOther').value.trim(); if (promoOther) promoInterest.push(promoOther);
                const courseType = document.querySelector('input[name="courseType"]:checked').value;
                const data = {
                    action: 'submit',
                    coachLineId: currentCoach.lineId, coachId: currentCoach.coachId, coachName: document.getElementById('coachName').value,
                    memberId: document.getElementById('memberId').value || null, clientName: document.getElementById('clientName').value,
                    courseType: courseType, isAiCustomer: document.querySelector('input[name="isAiCustomer"]:checked').value,
                    sessionTime: document.getElementById('sessionTime').value, preAssessment: document.getElementById('preAssessment').value,
                    courseContent: courseContent.join(', '), purchaseWillingness: document.querySelector('input[name="purchaseWillingness"]:checked').value,
                    customerCare: document.getElementById('customerCare').value, promoInterest: promoInterest.join(', '),
                    submittedAt: new Date().toISOString(), source: 'liff_form',
                    targetSheet: courseType === 'é‡è¨“' ? 'weight_training' : 'pilates'
                };
                console.log('ğŸ“¤ æäº¤è³‡æ–™:', data);
                const response = await fetchWithTimeout(CONFIG.webhookUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) }, 15000);
                console.log('ğŸ“¥ æäº¤å›æ‡‰:', response.status);
                if (!response.ok) throw new Error('æäº¤å¤±æ•—');
                showSuccess();
            } catch (err) { 
                console.error('âŒ Submit error:', err); 
                if (err.name === 'AbortError') {
                    alert('æäº¤è¶…æ™‚ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šå¾Œé‡è©¦');
                } else {
                    // å³ä½¿æœ‰éŒ¯èª¤ï¼Œä¹Ÿé¡¯ç¤ºæˆåŠŸï¼ˆè³‡æ–™å¯èƒ½å·²é€å‡ºï¼‰
                    showSuccess(); 
                }
            }
            finally { hideLoading(); btn.disabled = false; }
        }

        function showLoading(text = 'è¼‰å…¥ä¸­...') { document.getElementById('loadingText').textContent = text; document.getElementById('loadingOverlay').classList.add('active'); }
        function hideLoading() { document.getElementById('loadingOverlay').classList.remove('active'); }
        function showSuccess() { document.getElementById('feedbackForm').style.display = 'none'; document.getElementById('noticeBox').style.display = 'none'; document.getElementById('successPage').classList.add('active'); window.scrollTo({ top: 0, behavior: 'smooth' }); }
        function resetForm() {
            document.getElementById('feedbackForm').reset(); document.getElementById('feedbackForm').style.display = 'block';
            document.getElementById('noticeBox').style.display = 'block'; document.getElementById('successPage').classList.remove('active');
            matchedMember = null; document.getElementById('memberId').value = ''; document.getElementById('searchResult').className = 'search-result';
            document.getElementById('coachName').value = currentCoach.name || currentCoach.displayName || '';
            const now = new Date(); now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            document.getElementById('sessionTime').value = now.toISOString().slice(0, 16);
            document.querySelectorAll('.form-group').forEach(g => g.classList.remove('has-error'));
            document.querySelectorAll('.form-input, .form-textarea').forEach(el => el.classList.remove('error'));
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        function escapeHtml(text) { if (!text) return ''; const div = document.createElement('div'); div.textContent = text; return div.innerHTML; }
    </script>
</body>
</html>
