<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ã€é‡è¨“ï¼å™¨æ¢°ã€‘é«”é©—å›å ±è¡¨ | è¡¡é»å¥åº·</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        :root {
            --white: #ffffff;
            --gray: #808080;
            --gray-light: #f5f5f5;
            --green: #7ac19a;
            --green-light: #e2ede6;
            --green-dark: #5f846f;
            --pink: #f2ac98;
            --pink-light: #faece8;
            --pink-dark: #c67566;
            --yellow: #ffe08b;
            --yellow-light: #fcf4e3;
            --yellow-dark: #ba9e60;
            --blue: #9fcccc;
            --blue-light: #daedec;
            --blue-dark: #66888e;
            --bg-main: var(--green-light);
            --bg-card: var(--white);
            --bg-input: var(--white);
            --primary: var(--green);
            --primary-dark: var(--green-dark);
            --text-primary: #2d3a33;
            --text-secondary: var(--gray);
            --text-light: #9ca89f;
            --border: #d8e0db;
            --error: var(--pink-dark);
            --radius: 12px;
            --radius-lg: 20px;
            --shadow: 0 4px 20px rgba(95, 132, 111, 0.1);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { overflow-x: hidden; width: 100%; max-width: 100vw; }
        body { font-family: 'Noto Sans TC', -apple-system, sans-serif; background: var(--bg-main); color: var(--text-primary); min-height: 100vh; line-height: 1.6; }
        .header { background: var(--white); padding: 16px 24px; text-align: center; box-shadow: 0 2px 10px rgba(95, 132, 111, 0.08); }
        .logo { font-size: 20px; font-weight: 700; color: var(--green-dark); letter-spacing: 2px; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .logo-icon { font-size: 24px; }
        .logo-sub { font-size: 15px; font-weight: 600; color: var(--text-primary); margin-top: 4px; }
        .coach-info-bar { background: var(--blue-light); padding: 12px 20px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid var(--border); }
        .coach-info-bar.loading { justify-content: center; }
        .coach-avatar { width: 36px; height: 36px; background: var(--blue); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 600; color: var(--white); }
        .coach-details { flex: 1; margin-left: 12px; }
        .coach-name { font-size: 16px; font-weight: 600; color: var(--text-primary); }
        .coach-role { font-size: 13px; color: var(--blue-dark); }
        .coach-status { font-size: 13px; color: var(--text-light); }
        .notice-box { background: var(--yellow-light); border-left: 4px solid var(--yellow-dark); border-radius: 0 var(--radius) var(--radius) 0; padding: 16px 18px; margin-bottom: 20px; }
        .notice-title { font-size: 15px; font-weight: 600; color: var(--yellow-dark); margin-bottom: 10px; display: flex; align-items: center; gap: 6px; }
        .notice-list { font-size: 14px; color: var(--text-primary); line-height: 1.8; padding-left: 20px; }
        .notice-list li { margin-bottom: 4px; }
        .notice-highlight { color: var(--pink-dark); font-weight: 500; }
        .main-content { max-width: 680px; margin: 0 auto; padding: 20px 20px 40px; width: 100%; }
        .card { background: var(--bg-card); border-radius: var(--radius-lg); padding: 28px; margin-bottom: 16px; box-shadow: var(--shadow); }
        .card-header { display: flex; align-items: center; gap: 12px; margin-bottom: 8px; }
        .card-icon { width: 44px; height: 44px; border-radius: 12px; background: var(--green-light); display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .card-title { font-size: 20px; font-weight: 700; color: var(--text-primary); }
        .card-desc { font-size: 14px; color: var(--text-light); margin-bottom: 24px; margin-left: 56px; }
        .section-title { font-size: 16px; font-weight: 600; color: var(--green-dark); margin: 28px 0 16px; padding-bottom: 10px; border-bottom: 2px solid var(--green-light); display: flex; align-items: center; gap: 8px; }
        .section-title:first-of-type { margin-top: 0; }
        .section-dot { width: 8px; height: 8px; background: var(--primary); border-radius: 50%; }
        .form-group { margin-bottom: 24px; }
        .form-group:last-child { margin-bottom: 0; }
        .form-label { display: block; font-size: 16px; font-weight: 500; color: var(--text-primary); margin-bottom: 10px; }
        .form-label .required { color: var(--pink-dark); margin-left: 2px; }
        .form-label .hint { font-weight: 400; color: var(--text-light); font-size: 14px; display: block; margin-top: 6px; line-height: 1.6; }
        .form-input, .form-textarea { width: 100%; padding: 12px 16px; font-size: 16px; font-family: inherit; border: 2px solid var(--border); border-radius: var(--radius); background: var(--bg-input); color: var(--text-primary); transition: all 0.25s ease; }
        .form-input:focus, .form-textarea:focus { outline: none; border-color: var(--primary); }
        .form-input::placeholder, .form-textarea::placeholder { color: var(--text-light); }
        .form-input:disabled, .form-input:read-only { background: var(--gray-light); color: var(--text-secondary); }
        .form-textarea { min-height: 100px; resize: vertical; line-height: 1.6; }
        .member-search-section { background: var(--blue-light); border-radius: var(--radius); padding: 20px; margin-bottom: 24px; }
        .search-title { font-size: 15px; font-weight: 600; color: var(--blue-dark); margin-bottom: 12px; display: flex; align-items: center; gap: 8px; }
        .search-row { display: flex; gap: 12px; align-items: end; }
        .search-input-group { flex: 1; display: flex; flex-direction: column; gap: 6px; }
        .search-input-group label { font-size: 14px; color: var(--text-secondary); }
        .search-input-group input { padding: 10px 14px; font-size: 16px; font-family: inherit; border: 2px solid var(--border); border-radius: var(--radius); background: var(--white); width: 100%; }
        .search-input-group input:focus { outline: none; border-color: var(--blue); }
        .btn-search { padding: 10px 20px; font-size: 15px; font-weight: 600; font-family: inherit; background: var(--blue); color: var(--white); border: none; border-radius: var(--radius); cursor: pointer; white-space: nowrap; transition: all 0.25s ease; }
        .btn-search:hover { background: var(--blue-dark); }
        .btn-search:disabled { opacity: 0.6; cursor: not-allowed; }
        .search-results { margin-top: 16px; display: none; max-height: 300px; overflow-y: auto; border: 1px solid var(--border); border-radius: var(--radius); background: var(--white); }
        .search-results.show { display: block; }
        .search-results.empty { padding: 16px; text-align: center; color: var(--text-light); }
        .search-result-item { padding: 14px 16px; border-bottom: 1px solid var(--border); cursor: pointer; transition: background 0.2s; }
        .search-result-item:last-child { border-bottom: none; }
        .search-result-item:hover { background: var(--green-light); }
        .result-name { font-weight: 600; font-size: 15px; color: var(--text-primary); }
        .result-info { font-size: 13px; color: var(--text-secondary); margin-top: 4px; }
        .result-coach { font-size: 12px; color: var(--blue-dark); margin-top: 2px; }
        .selected-member { margin-top: 16px; padding: 14px; border-radius: var(--radius); background: var(--green-light); border: 1px solid var(--green); display: none; }
        .selected-member.show { display: block; }
        .selected-member-info { display: flex; align-items: center; gap: 12px; }
        .selected-avatar { width: 40px; height: 40px; background: var(--green); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 16px; font-weight: 600; color: var(--white); }
        .selected-details { flex: 1; }
        .selected-name { font-weight: 600; font-size: 16px; color: var(--green-dark); }
        .selected-extra { font-size: 13px; color: var(--text-secondary); margin-top: 2px; }
        .btn-clear { padding: 6px 12px; font-size: 12px; background: transparent; border: 1px solid var(--green-dark); color: var(--green-dark); border-radius: 6px; cursor: pointer; }
        .btn-clear:hover { background: var(--green-dark); color: var(--white); }
        .form-grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        .form-grid-2 .form-group { margin-bottom: 0; }
        .inline-radio-group { display: flex; flex-wrap: wrap; gap: 20px; }
        .inline-radio-option { display: flex; align-items: center; gap: 8px; cursor: pointer; }
        .inline-radio-option input[type="radio"] { width: 18px; height: 18px; accent-color: var(--primary); cursor: pointer; margin: 0; }
        .inline-radio-text { font-size: 16px; font-weight: 500; color: var(--text-primary); display: flex; align-items: center; gap: 6px; }
        .inline-radio-icon { font-size: 18px; }
        .checkbox-group { display: flex; flex-wrap: wrap; gap: 10px; }
        .checkbox-option { position: relative; }
        .checkbox-option input { position: absolute; opacity: 0; }
        .checkbox-label { display: inline-flex; align-items: center; padding: 10px 18px; background: var(--gray-light); border: 2px solid var(--border); border-radius: 50px; cursor: pointer; font-size: 15px; font-weight: 500; color: var(--text-primary); transition: all 0.25s ease; }
        .checkbox-option input:checked + .checkbox-label { background: var(--green-light); border-color: var(--primary); color: var(--green-dark); }
        .scale-group { display: flex; justify-content: space-between; gap: 6px; width: 100%; }
        .scale-option { flex: 1; position: relative; }
        .scale-option input { position: absolute; opacity: 0; width: 100%; height: 100%; cursor: pointer; z-index: 1; }
        .scale-label { display: flex; align-items: center; justify-content: center; padding: 14px 8px; background: var(--gray-light); border: 2px solid var(--border); border-radius: 10px; cursor: pointer; font-size: 16px; font-weight: 600; color: var(--text-secondary); transition: all 0.25s ease; }
        .scale-option input:checked + .scale-label { background: var(--primary); border-color: var(--primary); color: var(--white); transform: scale(1.05); box-shadow: 0 4px 12px rgba(122, 193, 154, 0.4); }
        .scale-labels { display: flex; justify-content: space-between; margin-top: 8px; font-size: 13px; color: var(--text-light); }
        .other-input-group { display: flex; align-items: center; gap: 10px; margin-top: 10px; }
        .other-input { flex: 1; padding: 10px 14px; font-size: 15px; font-family: inherit; border: 2px solid var(--border); border-radius: var(--radius); background: var(--bg-input); color: var(--text-primary); }
        .other-input:focus { outline: none; border-color: var(--primary); }
        .form-input.error, .form-textarea.error { border-color: var(--error); }
        .error-message { font-size: 13px; color: var(--error); margin-top: 6px; display: none; }
        .form-group.has-error .error-message { display: block; }
        .submit-section { margin-top: 32px; }
        .btn-submit { width: 100%; padding: 16px 24px; font-size: 17px; font-weight: 600; font-family: inherit; border-radius: var(--radius); cursor: pointer; transition: all 0.25s ease; display: flex; align-items: center; justify-content: center; gap: 8px; background: var(--primary); color: var(--white); border: none; box-shadow: 0 4px 15px rgba(122, 193, 154, 0.4); }
        .btn-submit:hover { background: var(--primary-dark); transform: translateY(-2px); }
        .btn-submit:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
        .success-page { display: none; text-align: center; padding: 60px 24px; }
        .success-page.active { display: block; animation: fadeSlideIn 0.4s ease; }
        @keyframes fadeSlideIn { from { opacity: 0; transform: translateY(16px); } to { opacity: 1; transform: translateY(0); } }
        .success-icon { width: 80px; height: 80px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 24px; font-size: 40px; color: var(--white); animation: scaleIn 0.5s ease 0.2s both; }
        @keyframes scaleIn { from { transform: scale(0); } to { transform: scale(1); } }
        .success-title { font-size: 24px; font-weight: 700; color: var(--text-primary); margin-bottom: 12px; }
        .success-message { font-size: 15px; color: var(--text-secondary); margin-bottom: 32px; line-height: 1.8; }
        .btn-reset { display: inline-flex; padding: 14px 40px; font-size: 15px; font-weight: 600; font-family: inherit; border-radius: var(--radius); cursor: pointer; background: var(--primary); color: var(--white); border: none; }
        .loading-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255, 255, 255, 0.95); z-index: 1000; align-items: center; justify-content: center; flex-direction: column; }
        .loading-overlay.active { display: flex; }
        .loading-spinner { width: 48px; height: 48px; border: 4px solid var(--green-light); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 16px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-text { font-size: 15px; color: var(--text-secondary); font-weight: 500; }
        .error-page { display: none; text-align: center; padding: 60px 24px; }
        .error-page.active { display: block; }
        .error-icon { width: 80px; height: 80px; background: var(--pink-light); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 24px; font-size: 40px; }
        .error-title { font-size: 20px; font-weight: 700; color: var(--text-primary); margin-bottom: 12px; }
        .error-desc { font-size: 14px; color: var(--text-secondary); margin-bottom: 24px; white-space: pre-line; }
        @media (max-width: 767px) {
            .main-content { padding: 16px 12px 40px; }
            .card { padding: 20px 22px; }
            .search-row { flex-direction: column; gap: 10px; }
            .btn-search { width: 100%; }
            .form-grid-2 { grid-template-columns: 1fr 1fr; gap: 12px; }
            .scale-label { padding: 12px 4px; font-size: 14px; }
        }
        @media (max-width: 480px) {
            .scale-label { padding: 10px 2px; font-size: 13px; }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo"><span class="logo-icon">ğŸŒ¿</span>è¡¡é»å¥åº·</div>
        <div class="logo-sub">ã€é‡è¨“ï¼å™¨æ¢°ã€‘é«”é©—å›å ±è¡¨</div>
    </header>
    <div class="coach-info-bar loading" id="coachInfoBar"><span class="coach-status">æ­£åœ¨è¼‰å…¥æ•™ç·´è³‡è¨Š...</span></div>
    <main class="main-content">
        <div class="error-page" id="errorPage">
            <div class="error-icon">âš ï¸</div>
            <h2 class="error-title" id="errorTitle">ç„¡æ³•è¼‰å…¥</h2>
            <p class="error-desc" id="errorDesc">è«‹é€é LINE é–‹å•Ÿæ­¤è¡¨å–®</p>
        </div>
        <div class="notice-box" id="noticeBox" style="display: none;">
            <div class="notice-title">ğŸ“‹ å¡«è¡¨é ˆçŸ¥</div>
            <ol class="notice-list">
                <li>æˆèª²å‰ä¸»å‹•èˆ‡è¡Œæ”¿ç¢ºèªå®¢æˆ¶é ç´„æ™‚é–“èˆ‡è³‡è¨Š</li>
                <li>å»ºè­°èª²ç¨‹é–‹å§‹ <strong>10åˆ†é˜å‰</strong> é ˆæŠµé”å ´é¤¨æº–å‚™</li>
                <li>é«”é©—èª²å‰ç¢ºå¯¦é€²è¡Œ Inbody æª¢æ¸¬åŠè«®è©¢è¡¨å¡«å¯«</li>
                <li>é«”é©—å¾Œä¸€å¾‹ç”±å ´é¤¨è¡Œæ”¿è«‡å–®ï¼Œå¦‚é‡ä¼‘å‡å‰‡ç”±æ•™ç·´é€²è¡Œ</li>
                <li>é«”é©—èª²å¾Œè«‹æ–¼ <span class="notice-highlight">8å°æ™‚å…§</span> å›å¡«æ­¤è¡¨</li>
                <li>ä¸€å°ä¸€é«”é©—ï¼šç¸½é•· 45 åˆ†é˜ ï½œ ä¸€å°äºŒé«”é©—ï¼šç¸½é•· 60 åˆ†é˜</li>
            </ol>
        </div>
        <form id="feedbackForm" style="display: none;">
            <div class="card">
                <div class="card-header"><div class="card-icon">ğŸ“</div><div class="card-title">é«”é©—å›å ±è¡¨</div></div>
                <div class="card-desc">è«‹æ–¼é«”é©—èª²å¾Œå¡«å¯«ä»¥ä¸‹è³‡è¨Š</div>
                
                <!-- æœå°‹è«®è©¢å–® -->
                <div class="member-search-section">
                    <div class="search-title">ğŸ” æœå°‹è«®è©¢å–®</div>
                    <div class="search-row">
                        <div class="search-input-group">
                            <label>è¼¸å…¥å®¢æˆ¶å§“å</label>
                            <input type="text" id="searchKeyword" placeholder="è¼¸å…¥å§“åé—œéµå­—...">
                        </div>
                        <button type="button" class="btn-search" id="btnSearch" onclick="searchConsultation()">æœå°‹</button>
                    </div>
                    <div class="search-results" id="searchResults"></div>
                    <div class="selected-member" id="selectedMember">
                        <div class="selected-member-info">
                            <div class="selected-avatar" id="selectedAvatar">?</div>
                            <div class="selected-details">
                                <div class="selected-name" id="selectedName">-</div>
                                <div class="selected-extra" id="selectedExtra">-</div>
                            </div>
                            <button type="button" class="btn-clear" onclick="clearSelection()">æ¸…é™¤</button>
                        </div>
                    </div>
                </div>
                
                <div class="section-title"><span class="section-dot"></span>èª²ç¨‹é¡å‹</div>
                <div class="form-group">
                    <label class="form-label">è«‹é¸æ“‡é«”é©—èª²ç¨‹<span class="required">*</span></label>
                    <div class="inline-radio-group">
                        <label class="inline-radio-option"><input type="radio" name="courseType" value="é‡è¨“" required><span class="inline-radio-text"><span class="inline-radio-icon">ğŸ‹ï¸</span>é‡è¨“</span></label>
                        <label class="inline-radio-option"><input type="radio" name="courseType" value="å™¨æ¢°çš®æ‹‰ææ–¯"><span class="inline-radio-text"><span class="inline-radio-icon">ğŸ§˜</span>å™¨æ¢°çš®æ‹‰ææ–¯</span></label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">æ˜¯å¦ç‚º AI æª¢æ¸¬ä¹‹å®¢æˆ¶<span class="required">*</span></label>
                    <div class="inline-radio-group">
                        <label class="inline-radio-option"><input type="radio" name="isAiCustomer" value="æ˜¯" required><span class="inline-radio-text">æ˜¯</span></label>
                        <label class="inline-radio-option"><input type="radio" name="isAiCustomer" value="å¦"><span class="inline-radio-text">å¦</span></label>
                    </div>
                </div>
                
                <div class="section-title"><span class="section-dot" style="background: var(--blue);"></span>åŸºæœ¬è³‡è¨Š</div>
                <div class="form-grid-2">
                    <div class="form-group">
                        <label class="form-label">å®¢æˆ¶å§“å<span class="required">*</span></label>
                        <input type="text" class="form-input" id="clientName" placeholder="æœå°‹å¾Œè‡ªå‹•å¡«å…¥" readonly required>
                        <input type="hidden" id="clientPhone">
                        <div class="error-message">è«‹å…ˆæœå°‹ä¸¦é¸æ“‡å®¢æˆ¶</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">è² è²¬æ•™ç·´<span class="required">*</span></label>
                        <input type="text" class="form-input" id="coachName" placeholder="è‡ªå‹•å¸¶å…¥" readonly>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">é«”é©—æ™‚æ®µ<span class="required">*</span></label>
                    <input type="datetime-local" class="form-input" id="sessionTime" required>
                </div>
                
                <div class="section-title"><span class="section-dot" style="background: var(--pink);"></span>èª²ç¨‹å…§å®¹</div>
                <div class="form-group">
                    <label class="form-label">èª²å‰è©•ä¼°å­¸å“¡çš„å“ªäº›å•é¡Œ<span class="required">*</span><span class="hint">å¦‚ Inbodyã€èª²å‰è«®è©¢å®¢äººéœ€æ±‚ç­‰</span></label>
                    <textarea class="form-textarea" id="preAssessment" placeholder="è«‹æè¿°èª²å‰è©•ä¼°çš„å…§å®¹..." required></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">ä»Šå¤©å¸¶çµ¦å­¸ç”Ÿçš„èª²ç¨‹å®‰æ’å…§å®¹<span class="required">*</span></label>
                    <div class="checkbox-group">
                        <div class="checkbox-option"><input type="checkbox" name="courseContent" id="content1" value="è‚©èƒŒ"><label class="checkbox-label" for="content1">è‚©èƒŒ</label></div>
                        <div class="checkbox-option"><input type="checkbox" name="courseContent" id="content2" value="æ ¸å¿ƒ"><label class="checkbox-label" for="content2">æ ¸å¿ƒ</label></div>
                        <div class="checkbox-option"><input type="checkbox" name="courseContent" id="content3" value="è‡€è…¿"><label class="checkbox-label" for="content3">è‡€è…¿</label></div>
                        <div class="checkbox-option"><input type="checkbox" name="courseContent" id="content4" value="æŸ”è»Ÿåº¦"><label class="checkbox-label" for="content4">æŸ”è»Ÿåº¦</label></div>
                    </div>
                    <div class="other-input-group"><input type="text" class="other-input" id="contentOther" placeholder="å…¶ä»–ï¼ˆè«‹èªªæ˜ï¼‰"></div>
                </div>
                
                <div class="section-title"><span class="section-dot" style="background: var(--yellow);"></span>è³¼èª²æ„é¡˜è©•ä¼°</div>
                <div class="form-group">
                    <label class="form-label">èª²å¾Œèªç‚ºå­¸å“¡è²·èª²çš„æ„é¡˜<span class="required">*</span><span class="hint">ç•¶ä¸‹å°±æˆäº¤è«‹é¸ 10</span></label>
                    <div class="scale-group">
                        <div class="scale-option"><input type="radio" name="purchaseWillingness" id="scale1" value="1" required><label class="scale-label" for="scale1">1</label></div>
                        <div class="scale-option"><input type="radio" name="purchaseWillingness" id="scale2" value="2"><label class="scale-label" for="scale2">2</label></div>
                        <div class="scale-option"><input type="radio" name="purchaseWillingness" id="scale3" value="3"><label class="scale-label" for="scale3">3</label></div>
                        <div class="scale-option"><input type="radio" name="purchaseWillingness" id="scale4" value="4"><label class="scale-label" for="scale4">4</label></div>
                        <div class="scale-option"><input type="radio" name="purchaseWillingness" id="scale5" value="5"><label class="scale-label" for="scale5">5</label></div>
                        <div class="scale-option"><input type="radio" name="purchaseWillingness" id="scale6" value="6"><label class="scale-label" for="scale6">6</label></div>
                        <div class="scale-option"><input type="radio" name="purchaseWillingness" id="scale7" value="7"><label class="scale-label" for="scale7">7</label></div>
                        <div class="scale-option"><input type="radio" name="purchaseWillingness" id="scale8" value="8"><label class="scale-label" for="scale8">8</label></div>
                        <div class="scale-option"><input type="radio" name="purchaseWillingness" id="scale9" value="9"><label class="scale-label" for="scale9">9</label></div>
                        <div class="scale-option"><input type="radio" name="purchaseWillingness" id="scale10" value="10"><label class="scale-label" for="scale10">10</label></div>
                    </div>
                    <div class="scale-labels"><span>æ„é¡˜ä½</span><span>ç•¶ä¸‹æˆäº¤</span></div>
                </div>
                
                <div class="section-title"><span class="section-dot" style="background: var(--blue);"></span>å®¢æœå”åŠ©</div>
                <div class="form-group">
                    <label class="form-label">å®¢æœäººå“¡å¯ä»¥å¦‚ä½•é—œå¿ƒ<span class="required">*</span><span class="hint">è«‹æè¿°å­¸å“¡ç¾å ´çš„å¯¦éš›è€ƒé‡ã€‚ä¾‹å¦‚ï¼šåƒ¹æ ¼ã€èª²ç¨‹æœŸé™å•é¡Œã€æƒ³å˜—è©¦å…¶ä»–èª²ç¨®ç­‰ã€‚<br>â€» è«‹å¦‚å¯¦å¡«å¯«è®“å®¢æœäººå“¡å¯ä»¥é‡‹å‡ºå½ˆæ€§ï¼Œå”åŠ©è€å¸«æˆäº¤</span></label>
                    <textarea class="form-textarea" id="customerCare" placeholder="è«‹è©³ç´°æè¿°å­¸å“¡çš„è€ƒé‡èˆ‡ç‹€æ…‹..." required></textarea>
                </div>
                
                <div class="section-title"><span class="section-dot" style="background: var(--pink);"></span>å„ªæƒ æ–¹æ¡ˆ</div>
                <div class="form-group">
                    <label class="form-label">é«”é©—å¾Œçœ‹åˆ°å„ªæƒ è¡¨å°æ–¼å“ªä¸€é …å„ªæƒ æ›´æ„Ÿèˆˆè¶£<span class="required">*</span></label>
                    <div class="checkbox-group">
                        <div class="checkbox-option"><input type="checkbox" name="promoInterest" id="promo1" value="è‚Œè‚‰è³¦èƒ½ä¼¸å±•èª²ç¨‹"><label class="checkbox-label" for="promo1">è‚Œè‚‰è³¦èƒ½ä¼¸å±•èª²ç¨‹</label></div>
                        <div class="checkbox-option"><input type="checkbox" name="promoInterest" id="promo2" value="AI 3Dé«”æ…‹æª¢æ¸¬"><label class="checkbox-label" for="promo2">AI 3Dé«”æ…‹æª¢æ¸¬</label></div>
                        <div class="checkbox-option"><input type="checkbox" name="promoInterest" id="promo3" value="èª²å¡å±•å»¶"><label class="checkbox-label" for="promo3">èª²å¡å±•å»¶</label></div>
                        <div class="checkbox-option"><input type="checkbox" name="promoInterest" id="promo4" value="æ²’æœ‰æä¾›å„ªæƒ è¡¨çµ¦å­¸å“¡"><label class="checkbox-label" for="promo4">æ²’æœ‰æä¾›å„ªæƒ è¡¨</label></div>
                    </div>
                    <div class="other-input-group"><input type="text" class="other-input" id="promoOther" placeholder="å…¶ä»–ï¼ˆè«‹èªªæ˜ï¼‰"></div>
                </div>
                
                <!-- æ–°å¢ï¼šç•¶ä¸‹è«‡å–®äººå“¡ -->
                <div class="section-title"><span class="section-dot" style="background: var(--yellow);"></span>è«‡å–®äººå“¡</div>
                <div class="form-group">
                    <label class="form-label">ç•¶ä¸‹è«‡å–®äººå“¡<span class="required">*</span></label>
                    <div class="inline-radio-group">
                        <label class="inline-radio-option"><input type="radio" name="salesPerson" value="è¡Œæ”¿" required><span class="inline-radio-text">è¡Œæ”¿</span></label>
                        <label class="inline-radio-option"><input type="radio" name="salesPerson" value="ç·šä¸Šå®¢æœ"><span class="inline-radio-text">ç·šä¸Šå®¢æœ</span></label>
                        <label class="inline-radio-option"><input type="radio" name="salesPerson" value="è€å¸«æœ¬äºº"><span class="inline-radio-text">è€å¸«æœ¬äºº</span></label>
                    </div>
                </div>
                
                <div class="submit-section"><button type="submit" class="btn-submit" id="submitBtn">æäº¤è¡¨å–® âœ“</button></div>
            </div>
        </form>
        <div class="success-page" id="successPage">
            <div class="success-icon">âœ“</div>
            <h2 class="success-title">æäº¤æˆåŠŸï¼</h2>
            <p class="success-message">é«”é©—å›å ±è¡¨å·²æˆåŠŸé€å‡º<br>è«®è©¢å–®è³‡æ–™å·²åŒæ­¥æ›´æ–°<br>æ„Ÿè¬æ‚¨çš„å¡«å¯«</p>
            <button class="btn-reset" onclick="resetForm()">å¡«å¯«æ–°è¡¨å–®</button>
        </div>
    </main>
    <div class="loading-overlay" id="loadingOverlay"><div class="loading-spinner"></div><div class="loading-text" id="loadingText">è¼‰å…¥ä¸­...</div></div>

    <script>
        /* ===== è¨­å®š ===== */
        const CONFIG = {
            liffId: '2007947083-zbtrhdFK',
            appsScriptUrl: 'https://script.google.com/macros/s/AKfycbxRapVSTefyki6MQdqPJ4JvCvcJCJ8wD5WiRO1M2mSTnZ0QNUi9yDx1pw3RxgdPZrej/exec',
            makeWebhookUrl: 'https://hook.us2.make.com/5fvtrvpkxzfnwgu6six72t3jpu8fmhu3'  // æŸ¥è©¢æ•™ç·´ç”¨
        };

        let currentCoach = { lineId: '', name: '', displayName: '', coachId: '', coachType: '' };
        let selectedConsultation = null;

        async function fetchWithTimeout(url, options, timeout = 15000) {
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), timeout);
            try {
                const response = await fetch(url, { ...options, signal: controller.signal });
                clearTimeout(timeoutId);
                return response;
            } catch (err) {
                clearTimeout(timeoutId);
                throw err;
            }
        }

        document.addEventListener('DOMContentLoaded', async function() {
            showLoading('æ­£åœ¨åˆå§‹åŒ–...');
            
            document.getElementById('searchKeyword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') { e.preventDefault(); searchConsultation(); }
            });
            
            try {
                await liff.init({ liffId: CONFIG.liffId });
                if (liff.isLoggedIn()) {
                    const profile = await liff.getProfile();
                    currentCoach.lineId = profile.userId;
                    currentCoach.displayName = profile.displayName;
                    
                    // ç”¨ Make æŸ¥è©¢æ•™ç·´è³‡æ–™
                    await fetchCoachInfo(profile.userId);
                } else {
                    liff.login();
                    return;
                }
            } catch (err) {
                console.error('LIFF Error:', err);
                if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                    currentCoach = { lineId: 'TEST', name: 'æ¸¬è©¦æ•™ç·´', displayName: 'æ¸¬è©¦æ•™ç·´' };
                    showCoachInfo();
                    showForm();
                } else {
                    showError('åˆå§‹åŒ–å¤±æ•—', err.message);
                }
            }
            hideLoading();
        });

        // ç”¨ Make æŸ¥è©¢æ•™ç·´è³‡æ–™
        async function fetchCoachInfo(lineId) {
            try {
                const response = await fetchWithTimeout(CONFIG.makeWebhookUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'search_coach', lineId: lineId })
                }, 10000);
                
                if (response.ok) {
                    const data = await response.json();
                    if (data && data.found) {
    currentCoach.name = data.name;
    currentCoach.coachId = data.id;
    currentCoach.coachType = data.coachType;
    showCoachInfo();
    showForm();
    preSelectCourseType(data.coachType);
    return;
}
                }
                
                // æ‰¾ä¸åˆ°æ•™ç·´ï¼Œç”¨ LINE é¡¯ç¤ºåç¨±
                if (currentCoach.displayName) {
                    currentCoach.name = currentCoach.displayName;
                    showCoachInfo();
                    showForm();
                    console.warn('æ‰¾ä¸åˆ°æ•™ç·´è³‡æ–™ï¼Œä½¿ç”¨ LINE é¡¯ç¤ºåç¨±');
                } else {
                    showError('æ‰¾ä¸åˆ°æ•™ç·´è³‡æ–™', 'è«‹è¯ç¹«ç®¡ç†å“¡è¨­å®šæ­¤ LINE ID');
                }
            } catch (err) {
                console.error('Fetch coach error:', err);
                // æŸ¥è©¢å¤±æ•—ï¼Œç”¨ LINE é¡¯ç¤ºåç¨±
                if (currentCoach.displayName) {
                    currentCoach.name = currentCoach.displayName;
                    showCoachInfo();
                    showForm();
                } else {
                    showError('æŸ¥è©¢æ•™ç·´è³‡æ–™å¤±æ•—', err.message);
                }
            }
        }

        // æ ¹æ“šæ•™ç·´é¡å‹é é¸èª²ç¨‹
        function preSelectCourseType(coachType) {
            if (coachType === 'strength_training') {
                const radio = document.querySelector('input[name="courseType"][value="é‡è¨“"]');
                if (radio) radio.checked = true;
            } else if (coachType === 'pilates') {
                const radio = document.querySelector('input[name="courseType"][value="å™¨æ¢°çš®æ‹‰ææ–¯"]');
                if (radio) radio.checked = true;
            }
            // ai_analysis, stretching ä¸é é¸
        }
        
        function showCoachInfo() {
            const coachBar = document.getElementById('coachInfoBar');
            coachBar.classList.remove('loading');
            coachBar.innerHTML = `<div class="coach-avatar">${currentCoach.name?.charAt(0) || '?'}</div><div class="coach-details"><div class="coach-name">${escapeHtml(currentCoach.name)}</div><div class="coach-role">é«”é©—æ•™ç·´</div></div><span class="coach-status">å·²ç™»å…¥ âœ“</span>`;
            document.getElementById('coachName').value = currentCoach.name || '';
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            document.getElementById('sessionTime').value = now.toISOString().slice(0, 16);
        }

        function showForm() {
            document.getElementById('errorPage').style.display = 'none';
            document.getElementById('noticeBox').style.display = 'block';
            document.getElementById('feedbackForm').style.display = 'block';
            document.getElementById('feedbackForm').addEventListener('submit', submitForm);
        }

        function showError(title, desc) {
            hideLoading();
            document.getElementById('errorPage').classList.add('active');
            document.getElementById('errorTitle').textContent = title;
            document.getElementById('errorDesc').textContent = desc;
        }

        // æœå°‹è«®è©¢å–®
        async function searchConsultation() {
            const keyword = document.getElementById('searchKeyword').value.trim();
            const resultsDiv = document.getElementById('searchResults');
            const btn = document.getElementById('btnSearch');
            
            if (!keyword) {
                resultsDiv.className = 'search-results show empty';
                resultsDiv.innerHTML = 'è«‹è¼¸å…¥å§“åé—œéµå­—';
                return;
            }
            
            btn.disabled = true;
            btn.textContent = 'æœå°‹ä¸­...';
            
            try {
                const url = CONFIG.appsScriptUrl + '?action=search&keyword=' + encodeURIComponent(keyword);
                const response = await fetchWithTimeout(url, { method: 'GET' });
                const data = await response.json();
                
                if (data.success && data.data && data.data.length > 0) {
    resultsDiv.className = 'search-results show';
    resultsDiv.innerHTML = 
        '<div style="padding: 10px 14px; font-size: 13px; color: #66888e; border-bottom: 1px solid #d8e0db;">ğŸ‘† è«‹é»é¸</div>' +
        data.data.map((item, index) => `
            <div class="search-result-item" onclick="selectConsultation(${index})">
                <div class="result-name">${escapeHtml(item.name)}</div>
            </div>
        `).join('');
    window.searchResults = data.data;
                } else {
                    resultsDiv.className = 'search-results show empty';
                    resultsDiv.innerHTML = 'æ‰¾ä¸åˆ°ç¬¦åˆçš„è«®è©¢å–®';
                }
            } catch (err) {
                console.error('Search error:', err);
                resultsDiv.className = 'search-results show empty';
                resultsDiv.innerHTML = 'æœå°‹å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦';
            } finally {
                btn.disabled = false;
                btn.textContent = 'æœå°‹';
            }
        }

        function selectConsultation(index) {
            const item = window.searchResults[index];
            selectedConsultation = item;
            
            document.getElementById('searchResults').className = 'search-results';
            document.getElementById('selectedMember').className = 'selected-member show';
            document.getElementById('selectedAvatar').textContent = item.name?.charAt(0) || '?';
            document.getElementById('selectedName').textContent = item.name;
            document.getElementById('selectedExtra').style.display = 'none';
            
            document.getElementById('clientName').value = item.name || '';
            document.getElementById('clientPhone').value = item.phone || '';
        }

        function clearSelection() {
            selectedConsultation = null;
            document.getElementById('selectedMember').className = 'selected-member';
            document.getElementById('clientName').value = '';
            document.getElementById('clientPhone').value = '';
            document.getElementById('searchKeyword').value = '';
        }

        function validateForm() {
            if (!selectedConsultation) { alert('è«‹å…ˆæœå°‹ä¸¦é¸æ“‡å®¢æˆ¶'); return false; }
            if (!document.querySelector('input[name="courseType"]:checked')) { alert('è«‹é¸æ“‡èª²ç¨‹é¡å‹'); return false; }
            if (!document.querySelector('input[name="isAiCustomer"]:checked')) { alert('è«‹é¸æ“‡æ˜¯å¦ç‚º AI æª¢æ¸¬ä¹‹å®¢æˆ¶'); return false; }
            if (!document.querySelector('input[name="purchaseWillingness"]:checked')) { alert('è«‹é¸æ“‡å­¸å“¡è²·èª²æ„é¡˜'); return false; }
            if (!document.querySelector('input[name="salesPerson"]:checked')) { alert('è«‹é¸æ“‡ç•¶ä¸‹è«‡å–®äººå“¡'); return false; }
            if (!document.getElementById('preAssessment').value.trim()) { alert('è«‹å¡«å¯«èª²å‰è©•ä¼°å…§å®¹'); return false; }
            if (!document.getElementById('customerCare').value.trim()) { alert('è«‹å¡«å¯«å®¢æœé—œå¿ƒå…§å®¹'); return false; }
            
            const contentChecked = document.querySelectorAll('input[name="courseContent"]:checked').length > 0;
            if (!contentChecked && !document.getElementById('contentOther').value.trim()) { alert('è«‹é¸æ“‡æˆ–å¡«å¯«èª²ç¨‹å®‰æ’å…§å®¹'); return false; }
            
            const promoChecked = document.querySelectorAll('input[name="promoInterest"]:checked').length > 0;
            if (!promoChecked && !document.getElementById('promoOther').value.trim()) { alert('è«‹é¸æ“‡æˆ–å¡«å¯«æ„Ÿèˆˆè¶£çš„å„ªæƒ æ–¹æ¡ˆ'); return false; }
            
            return true;
        }

        async function submitForm(e) {
            e.preventDefault();
            if (!validateForm()) return;
            
            const btn = document.getElementById('submitBtn');
            btn.disabled = true;
            showLoading('æ­£åœ¨æäº¤è¡¨å–®ä¸¦æ›´æ–°è«®è©¢å–®...');
            
            try {
                const courseContent = [];
                document.querySelectorAll('input[name="courseContent"]:checked').forEach(cb => courseContent.push(cb.value));
                if (document.getElementById('contentOther').value.trim()) courseContent.push(document.getElementById('contentOther').value.trim());
                
                const promoInterest = [];
                document.querySelectorAll('input[name="promoInterest"]:checked').forEach(cb => promoInterest.push(cb.value));
                if (document.getElementById('promoOther').value.trim()) promoInterest.push(document.getElementById('promoOther').value.trim());
                
                const data = {
                    clientName: document.getElementById('clientName').value,
                    phone: document.getElementById('clientPhone').value,
                    courseType: document.querySelector('input[name="courseType"]:checked').value,
                    isAiCustomer: document.querySelector('input[name="isAiCustomer"]:checked').value,
                    coachName: document.getElementById('coachName').value,
                    sessionTime: formatSessionTime(document.getElementById('sessionTime').value),
                    preAssessment: document.getElementById('preAssessment').value,
                    courseContent: courseContent.join(', '),
                    purchaseWillingness: document.querySelector('input[name="purchaseWillingness"]:checked').value,
                    customerCare: document.getElementById('customerCare').value,
                    promoInterest: promoInterest.join(', '),
                    salesPerson: document.querySelector('input[name="salesPerson"]:checked').value,
                    submittedAt: new Date().toISOString(),
                    source: 'web_form'
                };
                
                const response = await fetchWithTimeout(CONFIG.appsScriptUrl, {
    method: 'POST',
    headers: { 'Content-Type': 'text/plain' },
    body: JSON.stringify(data),
    redirect: 'follow'
});
                
                const result = await response.json();
                if (result.success) {
                    showSuccess();
                } else {
                    throw new Error(result.error || 'æäº¤å¤±æ•—');
                }
            } catch (err) {
                console.error('Submit error:', err);
                alert('æäº¤å¤±æ•—ï¼š' + err.message);
            } finally {
                hideLoading();
                btn.disabled = false;
            }
        }

        function showLoading(text) { document.getElementById('loadingText').textContent = text; document.getElementById('loadingOverlay').classList.add('active'); }
        function hideLoading() { document.getElementById('loadingOverlay').classList.remove('active'); }
        function showSuccess() {
            document.getElementById('feedbackForm').style.display = 'none';
            document.getElementById('noticeBox').style.display = 'none';
            document.getElementById('successPage').classList.add('active');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        function resetForm() {
            document.getElementById('feedbackForm').reset();
            document.getElementById('feedbackForm').style.display = 'block';
            document.getElementById('noticeBox').style.display = 'block';
            document.getElementById('successPage').classList.remove('active');
            selectedConsultation = null;
            document.getElementById('selectedMember').className = 'selected-member';
            document.getElementById('clientName').value = '';
            document.getElementById('clientPhone').value = '';
            document.getElementById('searchKeyword').value = '';
            document.getElementById('searchResults').className = 'search-results';
            document.getElementById('coachName').value = currentCoach.name || '';
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            document.getElementById('sessionTime').value = now.toISOString().slice(0, 16);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        function formatSessionTime(dateTimeStr) {
            if (!dateTimeStr) return '';
            const date = new Date(dateTimeStr);
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const hours = date.getHours();
            const minutes = date.getMinutes();
            const seconds = date.getSeconds();
            
            const period = hours >= 12 ? 'ä¸‹åˆ' : 'ä¸Šåˆ';
            const hour12 = hours > 12 ? hours - 12 : (hours === 0 ? 12 : hours);
            
            const pad = (n) => n.toString().padStart(2, '0');
            
            return `${year}/${month}/${day} ${period} ${hour12}:${pad(minutes)}:${pad(seconds)}`;
        }

        function escapeHtml(text) { if (!text) return ''; const div = document.createElement('div'); div.textContent = text; return div.innerHTML; }
    </script>
</body>
</html>
